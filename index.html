<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æŠ•è³‡é›™æ•ˆè¨ˆç®—æ©Ÿ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #0F0F11;
            --card-bg: rgba(30, 30, 33, 0.6);
            --input-bg: #27272a;
            --border-color: rgba(255, 255, 255, 0.08);

            --blue-primary: #6366F1;
            --blue-glow: rgba(99, 102, 241, 0.15);

            --green-primary: #10B981;
            --green-glow: rgba(16, 185, 129, 0.15);

            --text-main: #FFFFFF;
            --text-secondary: #a1a1aa;

            --radius-lg: 20px;
            --radius-md: 12px;
        }

        * {
            box-sizing: border-box;
            outline: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            /* æ”¹ç‚ºé ä¸Šå°é½Šï¼Œé©æ‡‰è®Šé•·çš„å…§å®¹ */
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            background-image:
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
        }

        .main-wrapper {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* é ‚éƒ¨æ¨™é¡Œ */
        .app-header {
            text-align: center;
            margin-bottom: 8px;
        }

        .app-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* é€šç”¨å¡ç‰‡æ¨£å¼ */
        .module-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .module-card:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* å¡ç‰‡é ‚éƒ¨è£é£¾ç·š */
        .card-blue::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6366F1, #8B5CF6);
        }

        .card-green::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10B981, #34D399);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .blue-text {
            color: #818cf8;
        }

        .green-text {
            color: #34d399;
        }

        .input-grid {
            display: grid;
            gap: 1rem;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 0.9rem;
            background-color: var(--input-bg);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--text-main);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
            color-scheme: dark;
        }

        input:focus {
            background-color: #3f3f46;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .card-blue input:focus {
            border-color: var(--blue-primary);
        }

        .card-green input:focus {
            border-color: var(--green-primary);
        }

        /* çµæœé¡¯ç¤ºå€å¡Š */
        .result-panel {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--radius-md);
            display: none;
            /* é è¨­éš±è— */
            animation: fadeIn 0.3s ease-out;
        }

        .blue-panel {
            background: var(--blue-glow);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .green-panel {
            background: var(--green-glow);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .big-stat {
            text-align: center;
            margin-bottom: 1rem;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: 0.2rem;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            padding-top: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item {
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
        }

        .detail-val {
            font-weight: 600;
            font-size: 1rem;
            margin-top: 2px;
        }

        /* å…¨å±€æŒ‰éˆ• */
        .btn-float {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFFFFF;
            color: #000;
            padding: 14px 32px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-float:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.3);
        }

        .btn-float:active {
            transform: translateX(-50%) scale(0.95);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        @media (max-width: 480px) {
            .btn-float {
                width: 90%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>

    <div class="main-wrapper">

        <div class="app-header">
            <h1>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M2 12h20" stroke-linecap="round" />
                    <circle cx="12" cy="12" r="8" />
                </svg>
                æŠ•è³‡ç¸¾æ•ˆè¨ˆç®—æ©Ÿ
            </h1>
        </div>

        <!-- å€å¡Šä¸€ï¼šç¸¾æ•ˆè¨ºæ–· (è—è‰²) -->
        <div class="module-card card-blue">
            <div class="card-title blue-text">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                </svg>
                ç›®å‰çš„æŠ•è³‡ç¸¾æ•ˆ
            </div>

            <div class="input-grid">
                <div class="input-row">
                    <div class="input-group">
                        <label>é–‹å§‹æ—¥æœŸ</label>
                        <input type="date" id="startDate" value="2020-04-30">
                    </div>
                    <div class="input-group">
                        <label>çµç®—æ—¥æœŸ</label>
                        <input type="date" id="endDate">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>ç¸½æˆæœ¬</label>
                        <input type="text" inputmode="decimal" id="totalCost" value="1,000,000"
                            oninput="formatInput(this)">
                    </div>
                    <div class="input-group">
                        <label>åº«å­˜ç¾å€¼</label>
                        <input type="text" inputmode="decimal" id="currentValue" value="1,500,000"
                            oninput="formatInput(this)">
                    </div>
                </div>
            </div>

            <!-- è—è‰²çµæœå€ -->
            <div class="result-panel blue-panel" id="resultPanel1">
                <div class="big-stat">
                    <div class="stat-label">å¹´åŒ–å ±é…¬ç‡ (IRR)</div>
                    <div class="stat-value" id="resIrr">--%</div>
                </div>
                <div class="details-grid">
                    <div class="detail-item">
                        <span>ç¸½ç²åˆ©é‡‘é¡</span>
                        <span class="detail-val" id="resProfit">--</span>
                    </div>
                    <div class="detail-item">
                        <span>ç¸½å ±é…¬ç‡</span>
                        <span class="detail-val" id="resTotalRoi">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å€å¡ŠäºŒï¼šç›®æ¨™é æ¸¬ (ç¶ è‰²) -->
        <div class="module-card card-green">
            <div class="card-title green-text">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 6v6l4 2" />
                </svg>
                æœªä¾†ç›®æ¨™é æ¸¬
            </div>

            <div
                style="font-size: 0.85rem; color: #a1a1aa; margin-bottom: 1rem; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px;">
                ğŸ’¡ å°‡ä½¿ç”¨ä¸Šæ–¹ç®—å‡ºçš„ <b>å¹´åŒ–å ±é…¬ç‡</b> é€²è¡Œè¤‡åˆ©æ¨ç®—
            </div>

            <div class="input-grid">
                <div class="input-row">
                    <div class="input-group">
                        <label>æœªä¾†æ¯æœˆæŠ•å…¥</label>
                        <input type="text" inputmode="decimal" id="futureMonthly" value="10,000"
                            oninput="formatInput(this)">
                    </div>
                    <div class="input-group">
                        <label>ç›®æ¨™ç¸½è³‡ç”¢</label>
                        <input type="text" inputmode="decimal" id="targetAmount" value="10,000,000"
                            oninput="formatInput(this)">
                    </div>
                </div>
            </div>

            <!-- ç¶ è‰²çµæœå€ -->
            <div class="result-panel green-panel" id="resultPanel2">
                <div class="big-stat">
                    <div class="stat-label">é è¨ˆé”æˆæ—¥æœŸ</div>
                    <div class="stat-value" id="resDate">--</div>
                </div>
                <div class="details-grid">
                    <div class="detail-item">
                        <span>é‚„éœ€è¦</span>
                        <span class="detail-val" id="resYearsLeft">-- å¹´</span>
                    </div>
                    <div class="detail-item">
                        <span>é”æˆæ™‚ç¸½è³‡ç”¢</span>
                        <span class="detail-val" id="resFinalAmount">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ç©ºé–“ï¼Œé¿å…æŒ‰éˆ•æ“‹ä½å…§å®¹ -->
        <div style="height: 60px;"></div>

    </div>

    <!-- æ‡¸æµ®åŸ·è¡ŒæŒ‰éˆ• -->
    <button class="btn-float" onclick="calculateAll()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        åŸ·è¡Œé‹ç®—
    </button>

    <script>
        // é è¨­çµç®—æ—¥ç‚ºä»Šå¤©
        document.getElementById('endDate').valueAsDate = new Date();

        // æ ¼å¼åŒ–è¼¸å…¥æ¡†åŠŸèƒ½
        function formatInput(input) {
            let value = input.value.replace(/,/g, '');
            if (value && !isNaN(value)) {
                if (value.indexOf('.') === -1) {
                    input.value = Number(value).toLocaleString('en-US');
                } else {
                    let parts = value.split('.');
                    parts[0] = Number(parts[0]).toLocaleString('en-US');
                    input.value = parts.join('.');
                }
            }
        }

        function getRawValue(id) {
            const val = document.getElementById(id).value.replace(/,/g, '');
            return parseFloat(val);
        }

        function calculateAll() {
            // --- 1. å–å¾—è³‡æ–™ ---
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const totalCost = getRawValue('totalCost');
            const currentValue = getRawValue('currentValue');
            const futurePmt = getRawValue('futureMonthly');
            const targetAmount = getRawValue('targetAmount');

            if (!startDate || !endDate || isNaN(totalCost) || isNaN(currentValue)) {
                alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½");
                return;
            }

            // --- 2. é‹ç®—ç¸¾æ•ˆ (è—è‰²å€å¡Š) ---
            const oneDay = 24 * 60 * 60 * 1000;
            const diffDays = Math.round(Math.abs((endDate - startDate) / oneDay));
            const exactMonths = diffDays / 30.44;

            if (exactMonths <= 0.1) {
                alert("æŠ•è³‡æ™‚é–“å¤ªçŸ­ï¼Œç„¡æ³•è¨ˆç®—");
                return;
            }

            const monthlyPmt = totalCost / exactMonths;
            const profit = currentValue - totalCost;
            const totalRoi = (profit / totalCost) * 100;

            // è¨ˆç®— IRR
            let low = -0.99, high = 5.0, guess = 0;
            for (let i = 0; i < 100; i++) {
                guess = (low + high) / 2;
                if (Math.abs(guess) < 0.0000001) guess = 0.0000001;
                let fv = monthlyPmt * ((Math.pow(1 + guess, exactMonths) - 1) / guess);
                if (fv > currentValue) high = guess; else low = guess;
            }

            const monthlyRate = guess;
            const annualRate = (Math.pow(1 + monthlyRate, 12) - 1) * 100;

            // é¡¯ç¤ºç¸¾æ•ˆçµæœ
            const fmtMoney = new Intl.NumberFormat('zh-TW', { style: 'decimal', maximumFractionDigits: 0 });

            const irrEl = document.getElementById('resIrr');
            irrEl.innerText = annualRate.toFixed(2) + "%";
            irrEl.style.color = annualRate >= 0 ? "#818cf8" : "#f87171"; // è—è‰²æˆ–ç´…è‰²

            document.getElementById('resProfit').innerText = (profit > 0 ? "+" : "") + "$" + fmtMoney.format(profit);
            document.getElementById('resProfit').style.color = profit >= 0 ? "#34d399" : "#f87171";

            document.getElementById('resTotalRoi').innerText = totalRoi.toFixed(2) + "%";

            // å±•é–‹è—è‰²é¢æ¿
            document.getElementById('resultPanel1').style.display = 'block';

            // --- 3. é‹ç®—é æ¸¬ (ç¶ è‰²å€å¡Š) ---
            let monthsNeeded = 0;
            let canPredict = true;

            if (monthlyRate <= 0) {
                // è² å ±é…¬æˆ–0ï¼Œç°¡å–®ç®—
                if (futurePmt > 0) {
                    monthsNeeded = (targetAmount - currentValue) / futurePmt;
                } else {
                    canPredict = false;
                }
            } else {
                // è¤‡åˆ©ç®—
                if (targetAmount > currentValue && futurePmt >= 0) {
                    const r = monthlyRate;
                    const numerator = targetAmount + (futurePmt / r);
                    const denominator = currentValue + (futurePmt / r);
                    const base = 1 + r;
                    monthsNeeded = Math.log(numerator / denominator) / Math.log(base);
                } else {
                    monthsNeeded = 0; // å·²ç¶“é”æˆ
                }
            }

            const dateEl = document.getElementById('resDate');
            const yearsEl = document.getElementById('resYearsLeft');
            const finalAmountEl = document.getElementById('resFinalAmount');

            if (canPredict && monthsNeeded > 0 && monthsNeeded < 1200) {
                const targetDate = new Date(endDate);
                targetDate.setDate(targetDate.getDate() + (monthsNeeded * 30.44));

                const y = targetDate.getFullYear();
                const m = targetDate.getMonth() + 1;

                dateEl.innerText = `${y}å¹´ ${m}æœˆ`;
                yearsEl.innerText = (monthsNeeded / 12).toFixed(1) + " å¹´";
                finalAmountEl.innerText = "$" + fmtMoney.format(targetAmount);
            } else if (monthsNeeded <= 0) {
                dateEl.innerText = "å·²é”æˆ!";
                yearsEl.innerText = "0 å¹´";
                finalAmountEl.innerText = "$" + fmtMoney.format(currentValue);
            } else {
                dateEl.innerText = "ç„¡æ³•è¨ˆç®—";
                yearsEl.innerText = "--";
                finalAmountEl.innerText = "--";
            }

            // å±•é–‹ç¶ è‰²é¢æ¿
            document.getElementById('resultPanel2').style.display = 'block';
        }
    </script>

</body>

</html>
